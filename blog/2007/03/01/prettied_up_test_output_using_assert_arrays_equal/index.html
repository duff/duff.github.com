
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Prettied up test output using assert_arrays_equal - Duff O'Melia</title>
  <meta name="author" content="Duff O'Melia">

  
  <meta name="description" content="I&#8217;ve got a pretty simple test: 1
2
3
4
5
def test_relationships wellspring = churches(:wellspring) cleaning_crew = Group.create!(:name =&gt; & &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://duff.github.com/blog/2007/03/01/prettied_up_test_output_using_assert_arrays_equal/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/duffomelia" rel="alternate" title="Duff O'Melia" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<script src="/javascripts/jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/javascripts/jquery-cookie.min.js" type="text/javascript"></script>
<script src="/javascripts/adn-timeline.min.js" type="text/javascript"></script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-11551778-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Duff O'Melia</a></h1>
  
</hgroup>

</header>
  <nav role="navigation">  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:duff.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/work">Work</a></li>
  <li><a href="/blog/archives">Archive</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Prettied Up Test Output Using assert_arrays_equal</h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-03-01T00:00:00-05:00" pubdate data-updated="true">Mar 1<span>st</span>, 2007</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I&#8217;ve got a pretty simple test:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">test_relationships</span>
</span><span class='line'>  <span class="n">wellspring</span> <span class="o">=</span> <span class="n">churches</span><span class="p">(</span><span class="ss">:wellspring</span><span class="p">)</span>
</span><span class='line'>  <span class="n">cleaning_crew</span> <span class="o">=</span> <span class="no">Group</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">&quot;Cleaning Crew&quot;</span><span class="p">,</span> <span class="ss">:church</span> <span class="o">=&gt;</span> <span class="n">wellspring</span><span class="p">)</span>
</span><span class='line'>  <span class="n">assert_equal</span><span class="p">(</span><span class="o">[</span><span class="n">cleaning_crew</span><span class="o">]</span><span class="p">,</span> <span class="n">wellspring</span><span class="o">.</span><span class="n">groups</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The problem is that when this test fails, I get a ridiculous amount of output and it&#8217;s difficult to quickly determine why the test is failing.  Here&#8217;s the output I get:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>1<span class="o">)</span> Failure:
</span><span class='line'>test_relationships:10
</span><span class='line'>&lt;<span class="o">[</span><span class="c">#&lt;Group:0x3492918</span>
</span><span class='line'>  @attributes<span class="o">=</span>
</span><span class='line'>   <span class="o">{</span><span class="s2">&quot;name&quot;</span><span class="o">=</span>&gt;<span class="s2">&quot;Cleaning Crew&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;church_id&quot;</span><span class="o">=</span>&gt;1,
</span><span class='line'>    <span class="s2">&quot;id&quot;</span><span class="o">=</span>&gt;32,
</span><span class='line'>at top level in <span class="s2">&quot;created_at&quot;</span><span class="o">=</span>&gt;Thu Mar 01 15 at line 56
</span><span class='line'>  @church<span class="o">=</span>
</span><span class='line'>at top level in <span class="c">#&lt;Church at line 0</span>
</span><span class='line'>    @attributes<span class="o">=</span>
</span><span class='line'>     <span class="o">{</span><span class="s2">&quot;name&quot;</span><span class="o">=</span>&gt;<span class="s2">&quot;Wellspring Community Church&quot;</span>,
</span><span class='line'>      <span class="s2">&quot;account_owner_id&quot;</span><span class="o">=</span>&gt;<span class="s2">&quot;1&quot;</span>,
</span><span class='line'>      <span class="s2">&quot;timezone&quot;</span><span class="o">=</span>&gt;<span class="s2">&quot;Alaska&quot;</span>,
</span><span class='line'>      <span class="s2">&quot;subdomain&quot;</span><span class="o">=</span>&gt;<span class="s2">&quot;wellspring&quot;</span>,
</span><span class='line'>      <span class="s2">&quot;id&quot;</span><span class="o">=</span>&gt;<span class="s2">&quot;1&quot;</span>,
</span><span class='line'>      <span class="s2">&quot;tz_name&quot;</span><span class="o">=</span>&gt;nil<span class="o">}</span>,
</span><span class='line'>    @groups<span class="o">=</span>
</span><span class='line'>at top level in <span class="c">#&lt;Group at line 0</span>
</span><span class='line'>  @errors<span class="o">=</span>
</span><span class='line'>at top level in <span class="c">#&lt;ActiveRecord::Errors at line 0</span>
</span><span class='line'>  @new_record<span class="o">=</span><span class="nb">false</span>&gt;<span class="o">]</span>&gt; expected but was
</span><span class='line'>&lt;<span class="o">[</span><span class="c">#&lt;Group:0x348c0a4 @attributes={&quot;name&quot;=&gt;&quot;Elders&quot;, &quot;church_id&quot;=&gt;&quot;1&quot;, &quot;id&quot;=&gt;&quot;1&quot;, &quot;created_at&quot;=&gt;&quot;2007-03-01 10:01:58&quot;}&gt;, #&lt;Group:0x348c07c @attributes={&quot;name&quot;=&gt;&quot;Children&#39;s Ministry&quot;, &quot;church_id&quot;=&gt;&quot;1&quot;, &quot;id&quot;=&gt;&quot;4&quot;, &quot;created_at&quot;=&gt;&quot;2007-03-01 10:01:58&quot;}&gt;, #&lt;Group:0x348c054 @attributes={&quot;name&quot;=&gt;&quot;Cleaning Crew&quot;, &quot;church_id&quot;=&gt;&quot;1&quot;, &quot;id&quot;=&gt;&quot;32&quot;, &quot;created_at&quot;=&gt;&quot;2007-03-01 15:56:38&quot;}&gt;]&gt;.</span>
</span><span class='line'>
</span><span class='line'>1 tests, 1 assertions, 1 failures, 0 errors
</span></code></pre></td></tr></table></div></figure>


<p>This is what I&#8217;d like the output to look like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'> 1<span class="o">)</span> Failure:
</span><span class='line'>test_relationships<span class="o">(</span>GroupTest<span class="o">)</span>
</span><span class='line'>method assert_arrays_equal in test_unit_extras.rb at line 8
</span><span class='line'>method test_relationships in group_test.rb at line 11
</span><span class='line'>&lt;<span class="s2">&quot;Cleaning Crew&quot;</span>&gt; expected but was
</span><span class='line'>&lt;<span class="s2">&quot;Elders, Children&#39;s Ministry, Cleaning Crew&quot;</span>&gt;.
</span><span class='line'>
</span><span class='line'>1 tests, 1 assertions, 1 failures, 0 errors
</span></code></pre></td></tr></table></div></figure>


<p>To me, that&#8217;s a bit easier to read.  Here&#8217;s how I did it.  The test has a small change.  Instead of calling assert_equal, it calls assert_arrays_equal.  So the test now looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">test_relationships</span>
</span><span class='line'>  <span class="n">wellspring</span> <span class="o">=</span> <span class="n">churches</span><span class="p">(</span><span class="ss">:wellspring</span><span class="p">)</span>
</span><span class='line'>  <span class="n">cleaning_crew</span> <span class="o">=</span> <span class="no">Group</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">&quot;Cleaning Crew&quot;</span><span class="p">,</span> <span class="ss">:church</span> <span class="o">=&gt;</span> <span class="n">wellspring</span><span class="p">)</span>
</span><span class='line'>  <span class="n">assert_arrays_equal</span><span class="p">(</span><span class="o">[</span><span class="n">cleaning_crew</span><span class="o">]</span><span class="p">,</span> <span class="n">wellspring</span><span class="o">.</span><span class="n">groups</span><span class="p">,</span> <span class="ss">:name</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Where did assert_arrays_equal come from?  You can get it by installing the plugin I just created:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>./script/plugin install git://github.com/duff/assert_arrays_equal.git
</span></code></pre></td></tr></table></div></figure>


<p>assert_arrays_equal allows you to specify which method you&#8217;d like to be called on the objects in your arrays for the output message.  It still asserts that the arrays are actually equal.  The failure error message now uses the method you specify.  In the test above, I specified the :name method because I want Group.#name to be called rather than Group#inspect.  If you don&#8217;t specify a method, it defaults to :to_s.</p>
</div>


  <footer>
    <p class="meta">
    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2007/02/28/expectations_and_mental_state/" title="Previous Post: Expectations and Mental State">&laquo; Expectations and Mental State</a>
      
      
        <a class="basic-alignment right" href="/blog/2007/05/03/rails-plugin-cadillacedgedeploy/" title="Next Post: Rails Plugin - cadillac_edge_deploy">Rails Plugin - cadillac_edge_deploy &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About</h1>
  <p>I write some code. <a href="/about">More...</a></p>
</section>

<section>
  <p>
    <a href="http://twitter.com/duffomelia">@duffomelia</a> on Twitter
  </p>
</section>
<section>
  <h1>Subscribe</h1>
  <br/>
  <p>
    <a style="text-decoration: none" href="http://feeds.feedburner.com/duffomelia" rel="subscribe-rss" title="Use your news reader to receive updates."><img style="vertical-align:middle" src="/images/rss.png" /> &nbsp; RSS</a>
  </li>
  <p>
    <a style="text-decoration: none" href="http://feedburner.google.com/fb/a/mailverify?uri=duffomelia&amp;loc=en_US" rel="subscribe-email" title="Receive an email whenever the blog is updated."><img style="vertical-align:middle" src="/images/email.png" /> &nbsp; Email </a>
  </p>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Christian O'Melia -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
